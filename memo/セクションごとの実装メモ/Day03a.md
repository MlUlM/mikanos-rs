# Day03aの実装メモ

## kernel.elfのエントリーポイントが呼び出されない

QemuモニタからRIPレジスタの値を確認したところ、ベースアドレスとはかけ離れたアドレスがセットされている！  
オリジナルMikanOSのブートローダーからも同様に呼び出せない...。

```shell
info registers
``` 

kernel.jsonに"exe-suffix": ".elf"というプロパティを追記したところ、オリジナルMikanOSのブートローダーからは呼び出せた！

## 4章で行うelfローダの実装で改善される？

day04dでelfローダーの実装を行うため、これを使えばロードできるらしい...？

## カーネルのロード処理

1. カーネルファイル(kernel.elf)を開く
2. カーネルファイルのサイズを取得
3. ファイルを一時的に読み込むためのバッファを作成
4. allocate_poolを使ってバッファのメモリを確保
5. カーネルファイルの最初と最後のアドレスを取得
6. 最初と最後のアドレスから